{
   "title": "Sapphire Plug-ins for Open Fx: ConvolveComp",
   "date": "2022-11-17T00:00:00",
   "thumbnail_url": "//cdn.borisfx.com/documentation/sapphire/ConvolveComp.jpg"
}
 <font size="1">
 </font>
 <table border="0" cellpadding="0" cellspacing="0" width="100%">
  <tr>
   <td valign="top">
    <a name="ConvolveComp">
     <h2>
      S_ConvolveComp
     </h2>
    </a>
    Convolves front and back images with a kernel, and
  composites them using a matte.  Convolution is a mathematical
  operator which uses one image, the kernel, as a filter shape for
  another image (the source).  Convolution effectively stamps a copy
  of the kernel at each point of the source, using the source's
  brightness at that point.  The effect is that a copy of the kernel
  will appear over all the bright spots of the source.  A kernel image
  shaped like a circle or polygon will give an effect similar to
  RackDefocusComp; a kernel image shaped like a starburst can give
  something like GlareComp.
    <p>
     The kernel size can vary between front and back so either or both
  can be blurred.
    </p>
    <p>
     In the Sapphire Blur+Sharpen effects submenu.
    </p>
    <p>
     <br/>
    </p>
    <h3>
     Inputs:
    </h3>
    <dl>
     <dd>
      <b>
       Foreground:
      </b>
      The clip to use as foreground.
     </dd>
    </dl>
    <p>
    </p>
    <dl>
     <dd>
      <b>
       Background:
      </b>
      The clip to use as background.
     </dd>
    </dl>
    <p>
    </p>
    <dl>
     <dd>
      <b>
       Matte:
      </b>
      <i>
       Optional.
      </i>
      The alpha channel of this input specifies the opacities of the Foreground
  input.  If this input is not provided, the alpha channel of the Foreground
  input is used instead.  This input can be affected by the Invert Matte or
  Matte Use parameters.
     </dd>
    </dl>
    <p>
    </p>
    <dl>
     <dd>
      <b>
       Kernel:
      </b>
      <i>
       Optional.
      </i>
      The filter kernel or shape for the convolution.  This
  should normally be all black around the edges (outside the specified
  Kernel Crop region), with a non-black central part.  A larger
  shape normally produces blurrier results.  Only the part of the
  kernel within the two Kernel Crop params is considered; the part
  outside that boundary is ignored.
     </dd>
    </dl>
   </td>
   <td>
   </td>
   <td align="right" valign="top" width="244">
    <table border="0" cellpadding="2" cellspacing="0">
     <tr>
      <td bgcolor="#303030" height="162" valign="center" width="240">
       <img align="center" alt="" height="162" src="//cdn.borisfx.com/documentation/sapphire/ConvolveComp.jpg" valign="bottom" width="240"/>
      </td>
     </tr>
    </table>
   </td>
  </tr>
 </table>
 <p>
 </p>
 <h3>
  Parameters:
 </h3>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Load Preset:
   </b>
   <i>
    Push-button
   </i>
   .
   <br/>
   Brings up the Preset Browser to browse all available presets for this effect.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Save Preset:
   </b>
   <i>
    Push-button
   </i>
   .
   <br/>
   Brings up the Preset Save dialog to save a preset for this effect.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Mocha Project:
   </b>
   <i>
    Default:
   </i>
   0,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Brings up the Mocha window for tracking footage and
  generating masks.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Blur Mocha:
   </b>
   <i>
    Default:
   </i>
   0,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Blurs the Mocha Mask by this amount before using.
  This can be used to soften the edges or quantization artifacts of
  the mask, and smooth out the time displacements.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Mocha Opacity:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 to 1.
   <br/>
   Controls the strength of the Mocha mask.
  Lower values reduce the intensity of the effect.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Invert Mocha:
   </b>
   <i>
    Check-box,  Default:
   </i>
   off.
   <br/>
   If enabled, the black and white of the Mocha Mask
  are inverted before applying the effect.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Resize Mocha:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 to 2.
   <br/>
   Scales the Mocha Mask.  1.0 is the original size.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Resize Rel X:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 to 2.
   <br/>
   The relative horizontal size of the Mocha Mask.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Resize Rel Y:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 to 2.
   <br/>
   The relative vertical size of the Mocha Mask.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Shift Mocha:
   </b>
   <i>
    X &amp; Y,   Default:
   </i>
   [0 0],
   <i>
    Range:
   </i>
   any.
   <br/>
   Offsets the position of the Mocha Mask.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Bypass Mocha:
   </b>
   <i>
    Check-box,  Default:
   </i>
   off.
   <br/>
   Ignore the Mocha Mask and apply the effect to the
  entire source clip.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Show Mocha Only:
   </b>
   <i>
    Check-box,  Default:
   </i>
   off.
   <br/>
   Bypass the effect and show the Mocha Mask itself.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Combine Masks:
   </b>
   <i>
    Popup menu,  Default: Union
   </i>
   .
   <br/>
   Determines how to combine the Mocha Mask and Input
  Mask when both are supplied to the effect.
   <br/>
   <dl>
    <dd>
     <b>
      <i>
       Union:
      </i>
     </b>
     Uses the area covered by both masks together.
     <br/>
     <dd>
      <b>
       <i>
        Intersect:
       </i>
      </b>
      Uses the area that overlaps between the two masks.
      <br/>
      <dd>
       <b>
        <i>
         Mocha Only:
        </i>
       </b>
       Ignore the Input Mask and only use the
  Mocha Mask.
       <br/>
      </dd>
     </dd>
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Size Front:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Size Front resizes the kernel larger or smaller when
  convolving the Front clip.  1.0 is the original size.  This parameter can be adjusted using the Size Front Widget.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Size Back:
   </b>
   <i>
    Default:
   </i>
   0,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Size Back resizes the kernel larger or smaller when convolving the Back clip.  This parameter can be adjusted using the Size Back Widget.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Size Rel X:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Increase to make the kernel fatter or wider
  without changing its height.  Decrease to shrink it horizontally,
  making it thinner.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Size Rel Y:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Increase to make the kernel taller
  without changing its wieght.  Decrease to shrink it vertically,
  making it flatter.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Kernel Center:
   </b>
   <i>
    X &amp; Y,   Default:
   </i>
   [0 0],
   <i>
    Range:
   </i>
   any.
   <br/>
   The center point of the kernel; if you think of
  convolution as repeated stamping of the kernel at each point of the
  source, the center is where the stamp aligns with the source pixels
  it's stamped over.  If you move the center to the right in the
  kernel, the whole result image will move to the left, and similarly
  up and down.  This parameter is ignored if AutoCenter is on.  It may
  be helpful to turn on Show Kernel while adjusting this parameter.
  Note that if Autocenter is off, the center point is always included
  in the kernel no matter what this param is set to.  This parameter can be adjusted using the Kernel Center Widget.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Autocenter:
   </b>
   <i>
    Check-box,  Default:
   </i>
   on.
   <br/>
   Automatically finds the center of the kernel image.
  Turning this on makes the effect ignore the Kernel Center parameter.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Use Color Kernel:
   </b>
   <i>
    Check-box,  Default:
   </i>
   off.
   <br/>
   Use each color channel of the kernel
  independently.  Turn this on if your kernel is not just black and
  white and you want the colors of the kernel to be used in the
  convolution.  Turn off for fastest rendering.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Show Kernel:
   </b>
   <i>
    Check-box,  Default:
   </i>
   off.
   <br/>
   Show the kernel over the result, for easier
  adjustment of kernel parameters.  Turn this off for final rendering.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Use Gamma:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0.1 or greater.
   <br/>
   Values above 1 cause highlights in the source clip to
  keep their brightness after the convolution filter is applied.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Matte Gamma:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0.1 or greater.
   <br/>
   The gamma value to use for the defocus of the Matte.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Boost Highlights:
   </b>
   <i>
    Default:
   </i>
   0,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   The amount to increase the luma of the highlights in the source clip.
  Increase this parameter to blow out the highlights without affecting the darks or mid-tones.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Hilight Threshold:
   </b>
   <i>
    Default:
   </i>
   0.9,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   The minimum luma value for highlights. Pixels brighter than this will be brightened according to the Boost Highlights parameter.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Comp Premult:
   </b>
   <i>
    Check-box,  Default:
   </i>
   on.
   <br/>
   Disable this if you have provided a separate Matte input
  and the Foreground pixel values have not been pre-multiplied by this Matte.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Front Brightness:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Scale the brightness of the convolved Front clip.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Front Opacity:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 to 1.
   <br/>
   Scale the opacity of the front clip before compositing over the back.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Front Threshold:
   </b>
   <i>
    Default:
   </i>
   0,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   In the Front clip, any source value below this will be treated as
  black. When combining the convolved result with the original, you
  can increase this value to only convolve bright areas of the source.
  Typically when using this parameter, you will also set Combine to
  Screen or Add to get a glare-like effect.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Threshold Add Color:
   </b>
   <i>
    Default rgb:
   </i>
   [0 0 0].
   <br/>
   This can be used to raise the threshold on a
  specific color and thereby reduce the convolved result generated on areas of the
  source clip containing that color.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Back Brightness:
   </b>
   <i>
    Default:
   </i>
   1,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Scale the brightness of the convolved Back clip.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Combine:
   </b>
   <i>
    Popup menu,  Default: Convolve Only
   </i>
   .
   <br/>
   Determines how the front, back, and convolved images are combined.
   <br/>
   <dl>
    <dd>
     <b>
      <i>
       Convolve Only:
      </i>
     </b>
     Convolve the Front and Back and composite them together.
                           Use this option for a blur or defocus-like effect
     <br/>
     <dd>
      <b>
       <i>
        Screen:
       </i>
      </b>
      Composite the Front over the convolved back, then screen with the convolved
                    front. Use this option for a glow or glare-like effect.
      <br/>
      <dd>
       <b>
        <i>
         Add:
        </i>
       </b>
       Composite the Front over the convolved back, then add the convolved
                    front.
       <br/>
       <dd>
        <b>
         <i>
          Difference:
         </i>
        </b>
        Composite the Front over the convolved back, then show the difference
                        with the convolved front.
        <br/>
       </dd>
      </dd>
     </dd>
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Edge Mode:
   </b>
   <i>
    X &amp; Y,  Popup menu,  Default:
   </i>
   [
   <i>
    Transparent Transparent
   </i>
   ].
   <br/>
   Determines the behavior when accessing areas outside the source image.
   <br/>
   <dl>
    <dd>
     <b>
      <i>
       Transparent:
      </i>
     </b>
     Areas outside the source image are treated as transparent, which can produce
                     transparency around the edges of the image.
             Select this for fastest rendering.
     <br/>
     <dd>
      <b>
       <i>
        Repeat:
       </i>
      </b>
      Repeats the last pixel outside the border of the image.
      <br/>
      <dd>
       <b>
        <i>
         Reflect:
        </i>
       </b>
       Reflects the image outside the border.
       <br/>
      </dd>
     </dd>
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Kernel Threshold:
   </b>
   <i>
    Default:
   </i>
   0.001,
   <i>
    Range:
   </i>
   0 or greater.
   <br/>
   Any kernel value below this will be treated as black.  It's
  important for the edges of the kernel image to be completely black,
  or the result will have a grayish cast to it.  If your kernel image
  may have a little noise in the black areas, turn up threshold a
  little to remove that background noise.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Clamp Below Thresh:
   </b>
   <i>
    Check-box,  Default:
   </i>
   on.
   <br/>
   When turned on, values below the threshold
  are clamped to zero.  This usually gives the best result.  For
  certain special cases with partially-negative kernels, turning this
  off gives you additional flexibility in designing your kernel.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Kernel Crop1:
   </b>
   <i>
    X &amp; Y,   Default:
   </i>
   [-0.997 -0.747],
   <i>
    Range:
   </i>
   any.
   <br/>
   The upper left corner of
  the kernel area.  Parts of the kernel image outside the rectangle
  defined by Kernel Crop1 and Kernel Crop2 are assumed to be
  black.  Making this area smaller to avoid processing the kernel's
  black edges can speed up the convolution somewhat.  It may be
  helpful to turn on Show Kernel while adjusting this parameter.  Note
  that if Autocenter is off, the center point is always included in
  the kernel no matter what this param is set to.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Kernel Crop2:
   </b>
   <i>
    X &amp; Y,   Default:
   </i>
   [0.997 0.747],
   <i>
    Range:
   </i>
   any.
   <br/>
   The lower right corner of the kernel area.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Autoscale Mode:
   </b>
   <i>
    Popup menu,  Default: Max Channel
   </i>
   .
   <br/>
   In convolution, either a larger or brighter
  kernel will make the result image brighter.  The kernel must be
  auto-scaled or normalized so the result is, on average, as bright as
  the input.  The autoscaling can be done in several ways, each of
  which is best in certain circumstances.  With a monochrome kernel
  or with Color Kernel turned off, Max Channel, Luma, and Indep Channels
  all give the same result.
   <br/>
   <dl>
    <dd>
     <b>
      <i>
       Max Channel:
      </i>
     </b>
     Autoscales the kernel by summing the
  elements of each channel, and using whichever is brightest as the
  overall kernel scale factor.  This normalizes a dim kernel to full
  brightness, and generally preserves the color of the kernel, but
  allows brightness variations in the dimmer channels to show in the
  result.
     <br/>
     <dd>
      <b>
       <i>
        Luma:
       </i>
      </b>
      Autoscales the kernel by summing the
  luminances of each kernel pixel.  This method preserves changes in
  the kernel's hue, but normalizes the luma, so a brighter or darker
  kernel will have no effect.  Use the Scale parameter to adjust the
  result brightness.
      <br/>
      <dd>
       <b>
        <i>
         Indep Channels:
        </i>
       </b>
       Independently normalizes each
  color channel of the kernel.  A colored kernel will give a
  white/gray result with this method.  Use this method if your kernel
  channels are independent of each other (i.e. different things going
  on in each of R, G, and B) but you want normalized results in each
  channel.
       <br/>
       <dd>
        <b>
         <i>
          Count Nonzero:
         </i>
        </b>
        Count how many kernel pixels are
  nonzero (brighter than black), but otherwise ignore how bright they
  are.  This method is best if you want variations in kernel hue and
  luma to show up in the result.  But blurring the kernel will give a
  dimmer result, since there will be more nonzero pixels.
        <br/>
        <dd>
         <b>
          <i>
           Kernel Size:
          </i>
         </b>
         Ignore the pixel
         <i>
          values
         </i>
         entirely;
  only use the size of the kernel rectangle to auto-scale.  Use this
  if you want all kernel variations to show up in the result, but
  don't use it if you intend to animate Kernel Crop1 and Crop2, as
  that would affect the result's brightness.
         <br/>
        </dd>
       </dd>
      </dd>
     </dd>
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Matte Use:
   </b>
   <i>
    Popup menu,  Default: Alpha
   </i>
   .
   <br/>
   Determines how the Matte input channels are used to make
a monochrome matte.
   <br/>
   <dl>
    <dd>
     <b>
      <i>
       Luma:
      </i>
     </b>
     the luminance of the RGB channels is used.
     <br/>
     <dd>
      <b>
       <i>
        Alpha:
       </i>
      </b>
      only the Alpha channel is used.
      <br/>
     </dd>
    </dd>
   </dl>
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Invert Matte:
   </b>
   <i>
    Check-box,  Default:
   </i>
   off.
   <br/>
   If enabled, the black and white of the matte
are inverted before use.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Soft Borders:
   </b>
   <i>
    Check-box,  Default:
   </i>
   off.
   <br/>
   If enabled, transparent borders are added to the
input image before processing.  This allows the result to include soft
edges beyond the original image size.  When off, the effect only
occurs within the frame and the result will retain an edge
at the borders.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Show Size Front:
   </b>
   <i>
    Check-box, Default:
   </i>
   on.
   <br/>
   Turns on or off the screen user interface for adjusting the
Size Front parameter.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Show Size Back:
   </b>
   <i>
    Check-box, Default:
   </i>
   on.
   <br/>
   Turns on or off the screen user interface for adjusting the
Size Back parameter.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Show Kernel Center:
   </b>
   <i>
    Check-box, Default:
   </i>
   off.
   <br/>
   Turns on or off the screen user interface for adjusting the
Kernel Center parameter.
  </dd>
 </dl>
 <p>
 </p>
 <dl>
  <dd>
   <b>
    Show Kernel Crop:
   </b>
   <i>
    Check-box, Default:
   </i>
   off.
   <br/>
   Turns on or off the screen user interface for adjusting the
Kernel Crop1 parameter.
  </dd>
 </dl>
 <p>
  <br/>
 </p>
 <h3>
  See Also:
 </h3>
 <dl>
  <dd>
   <table border="0" cellpadding="0" cellspacing="0">
    <tr>
     <td valign="top">
      <a href="../rackdefocus">
       RackDefocus
      </a>
      <br/>
      <a href="../defocusprism">
       DefocusPrism
      </a>
      <br/>
     </td>
     <td width="40">
     </td>
     <td valign="top">
     </td>
     <td width="40">
     </td>
     <td valign="top">
      <a href="../rackdfcomp">
       RackDfComp
      </a>
      <br/>
      <a href="../blur">
       Blur
      </a>
      <br/>
      <a href="../blurchannels">
       BlurChannels
      </a>
      <br/>
      <a href="../blurchroma">
       BlurChroma
      </a>
      <br/>
      <a href="../zdefocus">
       ZDefocus
      </a>
      <br/>
      <a href="../convolve">
       Convolve
      </a>
      <br/>
     </td>
     <td width="40">
     </td>
     <td valign="top">
      <a href="../intro">
       Sapphire Plug-ins Introduction
      </a>
     </td>
    </tr>
   </table>
  </dd>
 </dl>
